//--------------------------------------------------------------------------------------
// File: TransitionMask.cpp
//
// 画面切り替え用のマスク表示クラス
//
// Date: 2023.9.10
// Author: Hideyasu Imase
//--------------------------------------------------------------------------------------
#include "pch.h"
#include "TransitionMask.h"
#include "ReadData.h"
#include "CommonSys.h"

using namespace DirectX;

// コンストラクタ
TransitionMask::TransitionMask(
	ID3D11Device* device,
	ID3D11DeviceContext* context,
	float interval
)
	: m_interval(interval)
	, m_rate(0.0f)
	, m_open(true)
	, m_request(CreateMaskRequest::NONE)
{
	// スプライトバッチの作成
	m_spriteBatch = std::make_unique<SpriteBatch>(context);
}

// 更新処理
void TransitionMask::Update(float elapsedTime)
{
	UNREFERENCED_PARAMETER(elapsedTime);

	if (m_open)
	{
		// オープン
		m_rate -= FRAME_TIME / m_interval;
		if (m_rate < 0.0f) m_rate = 0.0f;
	}
	else
	{
		// クローズ
		m_rate += FRAME_TIME / m_interval;
		if (m_rate > 1.0f) m_rate = 1.0f;
	}
}

// 描画処理
void TransitionMask::Draw(
	ID3D11DeviceContext* context,
	DirectX::CommonStates* states,
	ID3D11ShaderResourceView* texture,
	const RECT& rect
)
{
	if (m_rate == 0.0f) return;

	m_spriteBatch->Begin(SpriteSortMode_Immediate, states->NonPremultiplied());

	m_spriteBatch->Draw(texture, rect, SimpleMath::Color(1.0f, 1.0f, 1.0f, m_rate));

	m_spriteBatch->End();
}

// マスクをオープンする関数
void TransitionMask::Open()
{
	m_open = true;
	m_rate = 1.0f;
}

// マスクをクローズする関数
void TransitionMask::Close()
{
	m_open = false;
	m_rate = 0.0f;
}

//// オープンしているかチェックする関数
//bool TransitionMask::IsOpen() const
//{
//	if (m_open && m_rate == 0.0f) return true;
//	return false;
//}
//
//// クローズしているかチェックする関数
//bool TransitionMask::IsClose() const
//{
//	if (!m_open && m_rate == 1.0f) return true;
//	return false;
//}
